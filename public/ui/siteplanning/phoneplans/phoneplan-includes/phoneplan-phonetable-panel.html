<div class="panel panel-default" style="box-shadow: 1px 1px 5px grey;">
	<div class="panel-heading" role="tab" id="PhonesHeading" style=" background-color: #aeb3b7; background-image: linear-gradient(#e4e6e7, #d6d9db 60%, #c9cccf)">

		<a class="collapsed" data-toggle="collapse" data-parent="#accordion" ng-href="" data-target="#collapse_phoneplan" style="color:black;cursor: pointer;" aria-expanded="false" aria-controls="collapse_phoneplan">
			<h4><b><i class="fa fa-phone-square"></i> Phone Table </b><i class="fa fa-caret-down"></i></h4>
		</a>
		
	</div>
		
	<div class="panel-body panel-collapse collapse  collapse in" role="tabpanel" id="collapse_phoneplan"  aria-labelledby="PhonesHeading" style="background-color:#F8F8F8;">
			
		<button class="btn btn-default active" ><span class="badge">{{vm.phones.length}}</span> Entries Found</button>
		<button class="btn btn-primary active"  ng-if="vm.phonecheckresult.length > 0"><span class="badge">{{vm.phonecheckresult.length}}</span> Phones Found in CUCM <i class="fa fa-phone-square"></i></button>
		<button class="btn btn-primary active"  ng-if="vm.phonenumbercheckresult.length > 0"><span class="badge">{{vm.phonenumbercheckresult.length}}</span> Numbers Found in CUCM <i class="fa fa-phone-square"></i></button>
		<div style="margin:25px"></div>
		
		<p><b style="color:red"><i>Note! </i></b>Phones in CUCM can take up to 5 minutes to update. Be Patient...</p>

		<div class="input-group col-md-3 ">
			<input type="text" class="form-control" ng-model="vm.search" ng-model-options="{ debounce: 10 }" placeholder="Search" name="srch-term" id="srch-term">
			<div class="input-group-btn">
				<button class="btn btn-default btn-disabled" ng-click="vm.search = undefined"><i class="glyphicon glyphicon-search"></i>
			</div>

		</div>
		
		<div style="margin:25px"></div>
			<button ng-if="vm.deleteall && vm.permissions.delete.Phone" class="btn btn-danger btn-sm"  ng-click="vm.deleteselected(vm.phones)">Delete Selected</button>
			<!--<a href="#/phone/create" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-plus"></i> Add</a>-->
			<button class="btn btn-primary btn-sm" ng-if="vm.permissions.create.Phone" ng-click="vm.phoneaddtoggle(vm.showaddrow)"><i class="glyphicon glyphicon-plus"></i> Add</button>
			<!--<button class="btn btn-primary btn-sm" ng-click="vm.phonebulkaddtoggle(vm.showbulkaddrows)"><i class="glyphicon glyphicon-plus"></i> Bulk Add - Needs work</button>-->
			<a href="#/phoneplan/{{ vm.phoneplan.id}}/importphones" ng-if="vm.permissions.create.Phone" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-plus"></i> Bulk Add</a>
			
			<button class="btn btn-default btn-sm" ng-click="vm.refresh()"><i class="glyphicon glyphicon-refresh"></i> Refresh</button>
			
			<div style="margin-top:10px; margin-botton:10px">
				<ng-include src="'siteplanning/phoneplans/createphone.html'"></ng-include>
			</div>

		
		<div class="panel panel-default" style="box-shadow: 1px 1px 5px grey;">
			<div class="table-responsive">    
				<table class="table table-striped table-condensed table-bordered table-hover">
					<thead>
						<tr class="info">
							<th><input type="checkbox" ng-model="vm.selectAll" ng-click="vm.checkAll()"/></th>
							<th>
								<a href="" ng-click="sortType = 'id'; sortReverse = !sortReverse" style="color:black">
									ID
										<span ng-if="sortType == 'id' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-if="sortType == 'id' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>

							<!--
							<th>
								<a href="" ng-click="sortType = 'parent'; sortReverse = !sortReverse" style="color:black">
									Parent ID
										<span ng-if="sortType == 'parent' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-if="sortType == 'parent' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>									
							-->
							<th>
								<a href="" ng-click="sortType = 'firstname'; sortReverse = !sortReverse" style="color:black">
									Firstname
										<span ng-if="sortType == 'firstname' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-if="sortType == 'firstname' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>							
							<th>
								<a href="" ng-click="sortType = 'lastname'; sortReverse = !sortReverse" style="color:black">
									Lastname
										<span ng-if="sortType == 'lastname' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-if="sortType == 'lastname' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							<th>
								<a href="" ng-click="sortType = 'username'; sortReverse = !sortReverse" style="color:black">
									Username (employees only)
										<span ng-show="sortType == 'username' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'username' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'name'; sortReverse = !sortReverse" style="color:black">
									Name
										<span ng-show="sortType == 'name' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'name' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'device'; sortReverse = !sortReverse" style="color:black">
									Device Type
										<span ng-show="sortType == 'device' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'device' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'dn'; sortReverse = !sortReverse" style="color:black">
									Directory Number
										<span ng-show="sortType == 'dn' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'dn' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>

														
							
							
							
							<th>
								<a href="" ng-click="sortType = 'language'; sortReverse = !sortReverse" style="color:black">
									Language
										<span ng-show="sortType == 'language' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'language' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'voicemail'; sortReverse = !sortReverse" style="color:black">
									Voicemail
										<span ng-show="sortType == 'voicemail' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'voicemail' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'notes'; sortReverse = !sortReverse" style="color:black">
									Notes
										<span ng-show="sortType == 'notes' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'notes' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							<!--
							<th>
								<a href="" ng-click="sortType = 'system_id'; sortReverse = !sortReverse" style="color:black">
									System ID
										<span ng-show="sortType == 'system_id' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'system_id' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							-->
							<th>
								<a href="" ng-click="sortType = 'created_at'; sortReverse = !sortReverse" style="color:black">
									Created At
										<span ng-show="sortType == 'created_at' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'created_at' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							
							<th>
								<a href="" ng-click="sortType = 'updated_at'; sortReverse = !sortReverse" style="color:black">
									Updated At
										<span ng-show="sortType == 'updated_at' && !sortReverse" class="glyphicon glyphicon-chevron-down"></span>
										<span ng-show="sortType == 'updated_at' && sortReverse" class="glyphicon glyphicon-chevron-up"></span>
								</a>
							</th>
							<th ng-if="vm.permissions.update.Phone || vm.permissions.delete.Phone">Actions</th>
						</tr>
					</thead>
					<tbody>
					<!-- Allow you to edit and delete Blocks with new buttons -->
					<tr ng-repeat="phone in vm.phones | orderBy:sortType:sortReverse | filter:vm.search: strict">
					
						<!--List View-->
						<td>
							<input type="checkbox" ng-model="phone.select" ng-click="vm.selecttouched()">
						</td>
						<td>{{ phone.id}}</td>
						<!--<td>{{ phone.parent}}</td>-->
						<td   ng-if="!vm.edit[phone.id]">{{ phone.firstname}}</td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.lastname}}</td>
						
						<td   ng-if="!vm.edit[phone.id] && phone.aduser != ''" style="color:green">{{ phone.username}}</td>
						<td   ng-if="!vm.edit[phone.id] && phone.aduser == ''" style="color:red">{{ phone.username}}</td>
						
						<!--
						<td   ng-if="!vm.edit[phone.id]">{{ phone.aduser}}</td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.adipphone}}</td>
						-->
						
						<td  ng-if="!vm.edit[phone.id]">
							<span ng-if="!phone.nameinvalid">{{ phone.name}} </span>
							<span ng-if="phone.nameinvalid" style="color:red">{{ phone.name}} </span>
							<a href="#/phone/{{phone.realname}}" target="_blank" ng-if="phone.cucmfound"><i class="fa fa-phone-square"></i></a>
						</td>
						
						<!--<td   ng-if="!vm.edit[phone.id]">{{ phone.name}}</td>-->
						<td   ng-if="!vm.edit[phone.id]">{{ phone.device}}</td>
						<td   ng-if="!vm.edit[phone.id] && !phone.dnint" style="color:red">{{ phone.dn}}</td>
						
						<td   ng-if="!vm.edit[phone.id] && phone.dnint">{{ phone.dn}}  <a href="#/line/{{phone.dn}}" target="_blank" ng-if="phone.numberfound"><i class="fa fa-phone-square"></i></a></td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.language}}</td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.voicemail}}</td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.notes}}</td>
						<!--<td   ng-if="!vm.edit[phone.id]">{{ phone.system_id}}</td>-->
						<td   ng-if="!vm.edit[phone.id]">{{ phone.created_at}}</td>
						<td   ng-if="!vm.edit[phone.id]">{{ phone.updated_at}}</td>

						
						<td  ng-if="vm.permissions.update.Phone || vm.permissions.delete.Phone" ng-show="!vm.edit[phone.id]">
							<button class="btn btn-xs btn-primary" ng-if="vm.permissions.update.Phone" ng-click="vm.edit[phone.id] = !vm.edit[phone.id]"> Edit </button>

							<!-- Function moved ot modal...
							<button class="btn btn-danger btn-xs " ng-click="vm.delete(phone)"> Delete </button>-->
							
							<button class="btn btn-danger btn-xs " ng-if="vm.permissions.delete.Phone" data-toggle="modal" data-target="#{{phone.id}}-modal"> Delete </button>
						
							<!-- Are you sure Modal - Hidden Unless Delete button is Pressed -->
							<div class="modal fade" id="{{phone.id}}-modal" role="dialog">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<h4>Are you sure? <h4>
										</div>
										<div class="modal-body">
											<p>You are about to delete Phone ID: {{ phone.id}}</p>
											<table class="table table-striped table-condensed table-bordered table-hover">
												<tr>
													<th>First Name</th>
													<th>Last Name</th>
													<th>User Name</th>
													<th>Device Name</th>
													<th>Directory Number</th>
												</tr>
												<tr>
													<td>{{ phone.firstname}}</td>
													<td>{{ phone.lastname}}</td>
													<td>{{ phone.username}}</td>
													<td>{{ phone.name}}</td>
													<td>{{ phone.dn}}</td>
												</tr>
											</table>
											<p>All provisioned information will be lost. Are you sure you want to proceed?</p>
										</div>
										<div class="modal-footer">

										<!--  dismiss modal not working with ng-click... Added jQuery Hack in Controller delete function.-->
										<a class="btn btn-danger" data-dismiss="modal" ng-click="vm.delete(phone)">Delete</a>
										<a class="btn btn-primary" data-dismiss="modal">Cancel</a>

											
										</div>
									</div>
								</div>
							</div> <!-- npa of Modal -->
							
							
						</td>
						<!--Edit View-->
						
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.firstname"></td>
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.lastname"></td>
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.username"></td>
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.name"></td>
						<!--<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.device"></td>-->
						<td   ng-if="vm.edit[phone.id]">
							<!--<input type="text" class="form-control form-control-sm" ng-model="newphone.language">-->
							<select class="form-control" ng-model='phone.device' ng-options="model as model for model in vm.phonemodels" data-width="100%" name="model">
							</select>
						</td>
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.dn"></td>
						<td   ng-if="vm.edit[phone.id]">
							<!--<input type="text" class="form-control form-control-sm" ng-model="phone.language">-->
							<select class="form-control" ng-model='phone.language' ng-options="language.name as language.name for language in vm.languages" data-width="100%" name="didblocks">
							</select>
						</td>
						<td   ng-if="vm.edit[phone.id]">
							<!--<input type="text" class="form-control form-control-sm" ng-model="phone.voicemail">-->
							<select class="form-control" ng-model='phone.voicemail' ng-options="value.name as value.name for value in vm.truefalse" data-width="100%" name="voicemail">
							</select>
						</td>
						<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.notes"></td>
						<!--<td   ng-if="vm.edit[phone.id]"><input type="text" class="form-control form-control-sm" ng-model="phone.system_id"></td>-->
						<td   ng-if="vm.edit[phone.id]">{{ phone.created_at}}</td>
						<td   ng-if="vm.edit[phone.id]">{{ phone.updated_at}}</td>
						
						<td  ng-if="vm.edit[phone.id]">
							<button class="btn btn-xs btn-primary"  ng-click="vm.update(phone);vm.edit[phone.id] = !vm.edit[phone.id]"> Save </button>
							<button class="btn btn-xs btn-warning"  ng-click="vm.edit[phone.id] = !vm.edit[phone.id]"> Undo </button>
						</td>
					</tr>
					</tbody>
				</table>
				</div>
			</div>
		
			<div style="margin:25px"></div>
			<!--<a href="#/phone/create" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-plus"></i> Add</a>-->
			<button ng-if="vm.deleteall && vm.permissions.delete.Phone" class="btn btn-danger btn-sm"  ng-click="vm.deleteselected(vm.phones)">Delete Selected</button>
			<button class="btn btn-default btn-sm" ng-click="vm.refresh()"><i class="glyphicon glyphicon-refresh"></i> Refresh</button>
			
			<div style="margin:50px"></div>
	</div>
</div>